<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Productos</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1>Productos</h1>
    <button class="back-button" onclick="history.back()">‚Üê Atr√°s</button>
  </header>
  <main>
    <div id="productos-container"></div>
  </main>
  <script src="storage.js"></script>
<script>
  const contenedor = document.getElementById('productos-container');
  const categorias = cargarCategorias();

  categorias.forEach(cat => {
    const productos = cargarProductosPorCategoria(cat);
    if (productos.length) {
      const grupo = document.createElement('section');
      grupo.innerHTML = `<h2>${cat}</h2>`;

      productos.forEach(prod => {
        const cantidadGuardada = prod.cantidad || '';
        const div = document.createElement('div');
        div.className = 'producto-item';
        div.innerHTML = `
          <img src="${prod.img || ''}" alt="${prod.nombre}" width="60">
          <strong>${prod.nombre}</strong><br>
          <small>${prod.bulto} por bulto</small><br>
          <input type="number" min="0" placeholder="Cantidad necesaria" value="${cantidadGuardada}" 
                 oninput="actualizarCalculo(this, ${prod.bulto}, '${prod.nombre}')">
          <div class="resultado"></div>
          <button onclick="eliminarProducto('${prod.nombre}')">üóëÔ∏è Eliminar</button>
        `;
        grupo.appendChild(div);

        // Mostrar c√°lculo si ya hab√≠a valor
        if (cantidadGuardada) {
          const input = div.querySelector('input');
          actualizarCalculo(input, prod.bulto, prod.nombre);
        }
      });

      contenedor.appendChild(grupo);
    }
  });

  function actualizarCalculo(input, bulto, nombre) {
    const cantidad = parseInt(input.value);
    const resultado = input.parentElement.querySelector('.resultado');
    const productos = cargarProductos();
    const index = productos.findIndex(p => p.nombre === nombre);

    if (!isNaN(cantidad)) {
      const bultos = Math.floor(cantidad / bulto);
      const resto = cantidad % bulto;
      resultado.innerText = `Necesit√°s ${bultos} bultos y sobran ${resto}`;
      if (index >= 0) {
        productos[index].cantidad = cantidad;
        localStorage.setItem('productos', JSON.stringify(productos));
      }
    } else {
      resultado.innerText = '';
    }
  }

  function eliminarProducto(nombre) {
    let productos = cargarProductos().filter(p => p.nombre !== nombre);
    localStorage.setItem('productos', JSON.stringify(productos));
    location.reload();
  }
</script>
</body>
</html>